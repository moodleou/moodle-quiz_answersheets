/**
 * JavaScript for the create_attempt_dialog class.
 *
 * @module    quiz_answersheets/create_attempt_dialog
 * @copyright  2019 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("quiz_answersheets/create_attempt_dialog",["jquery","core/modal_events","core/ajax","core/notification","core/modal_save_cancel"],(function($,ModalEvents,Ajax,Notification,ModalSaveCancel){var t={SELECTOR:".create-attempt-btn",init:function(){$(t.SELECTOR).click((function(e){e.preventDefault();var target=$(this).closest("table").find("button");t.disableButton(target,!0);var message=$(this).data("message"),params={quizid:$(this).data("quiz-id"),userid:$(this).data("user-id"),url:$(this).data("url")};ModalSaveCancel.create({title:M.util.get_string("create_attempt_modal_title","quiz_answersheets"),body:message,buttons:{save:M.util.get_string("create_attempt_modal_button","quiz_answersheets")},show:!0}).then((modal=>(modal.getRoot().on(ModalEvents.save,params,t.createAttempt),modal.show(),modal.getRoot().on(ModalEvents.hidden,modal,t.closeModal),modal))).catch((function(err){t.exceptionHandler(err,target)}))}))},closeModal:function(e){var modal=e.data,target=$(t.SELECTOR).closest("table").find("button");modal.destroy(),t.disableButton(target,!1)},createAttempt:function(e){e.preventDefault();var data=e.data,modalButtons=$(e.target).find("button");t.disableButton(modalButtons,!0),Ajax.call([{methodname:"quiz_answersheets_create_attempt",args:{quizid:data.quizid,userid:data.userid}}])[0].then((function(res){var id=res.id||"";return window.location.href=t.updateQueryStringParameter(data.url,"lastchanged",id),!0})).fail((function(err){t.exceptionHandler(err,modalButtons)}))},disableButton:function(el,status){el.prop("disabled",status)},exceptionHandler:function(ex,el){Notification.exception(ex),t.disableButton(el,!1)},updateQueryStringParameter:function(uri,key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=-1!==uri.indexOf("?")?"&":"?";return uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+separator+key+"="+value}};return t}));

//# sourceMappingURL=create_attempt_dialog.min.js.map