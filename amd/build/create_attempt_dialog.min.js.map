{"version":3,"file":"create_attempt_dialog.min.js","sources":["../src/create_attempt_dialog.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the create_attempt_dialog class.\n *\n * @module    quiz_answersheets/create_attempt_dialog\n * @package   quiz_answersheets\n * @copyright  2019 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/ajax', 'core/notification'],\n    function($, ModalFactory, ModalEvents, Ajax, Notification) {\n        var t = {\n            SELECTOR: '.create-attempt-btn',\n            init: function() {\n                $(t.SELECTOR).click(function(e) {\n                    e.preventDefault();\n                    var target = $(this).closest('table').find('button');\n                    t.disableButton(target, true);\n                    var message = $(this).data('message');\n                    var modalButton = M.util.get_string('create_attempt_modal_button', 'quiz_answersheets');\n                    var params = {\n                        quizid: $(this).data('quiz-id'),\n                        userid: $(this).data('user-id'),\n                        url: $(this).data('url')\n                    };\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: M.util.get_string('create_attempt_modal_title', 'quiz_answersheets'),\n                        body: message\n                    }).done(function(modal) {\n                        modal.setSaveButtonText(modalButton);\n                        modal.getRoot().on(ModalEvents.save, params, t.createAttempt);\n                        modal.show();\n                        // Handle hidden event.\n                        modal.getRoot().on(ModalEvents.hidden, modal, t.closeModal);\n                        return modal;\n                    }).catch(function(err) {\n                        t.exceptionHandler(err, target);\n                    });\n                });\n            },\n            closeModal: function(e) {\n                var modal = e.data;\n                var target = $(t.SELECTOR).closest('table').find('button');\n                modal.destroy();\n                t.disableButton(target, false);\n            },\n            createAttempt: function(e) {\n                e.preventDefault();\n                var data = e.data;\n                var modalButtons = $(e.target).find('button');\n                t.disableButton(modalButtons, true);\n                var promises = Ajax.call([{\n                    methodname: 'quiz_answersheets_create_attempt',\n                    args: {\n                        quizid: data.quizid,\n                        userid: data.userid\n                    }\n                }]);\n                // Handle promise.\n                promises[0].then(function(res) {\n                    var id = res.id || '';\n                    window.location.href = t.updateQueryStringParameter(data.url, 'lastchanged', id);\n                    return true;\n                }).fail(function(err) {\n                    t.exceptionHandler(err, modalButtons);\n                });\n            },\n            disableButton: function(el, status) {\n                el.prop(\"disabled\", status);\n            },\n            exceptionHandler: function(ex, el) {\n                Notification.exception(ex);\n                t.disableButton(el, false);\n            },\n            updateQueryStringParameter: function(uri, key, value) {\n                var re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\");\n                var separator = uri.indexOf('?') !== -1 ? \"&\" : \"?\";\n                if (uri.match(re)) {\n                    return uri.replace(re, '$1' + key + \"=\" + value + '$2');\n                } else {\n                    return uri + separator + key + \"=\" + value;\n                }\n            }\n        };\n        return t;\n    });\n"],"names":["define","$","ModalFactory","ModalEvents","Ajax","Notification","t","SELECTOR","init","click","e","preventDefault","target","this","closest","find","disableButton","message","data","modalButton","M","util","get_string","params","quizid","userid","url","create","type","types","SAVE_CANCEL","title","body","done","modal","setSaveButtonText","getRoot","on","save","createAttempt","show","hidden","closeModal","catch","err","exceptionHandler","destroy","modalButtons","call","methodname","args","then","res","id","window","location","href","updateQueryStringParameter","fail","el","status","prop","ex","exception","uri","key","value","re","RegExp","separator","indexOf","match","replace"],"mappings":";;;;;;;;AAuBAA,iDAAO,CAAC,SAAU,qBAAsB,oBAAqB,YAAa,sBACtE,SAASC,EAAGC,aAAcC,YAAaC,KAAMC,kBACrCC,EAAI,CACJC,SAAU,sBACVC,KAAM,WACFP,EAAEK,EAAEC,UAAUE,OAAM,SAASC,GACzBA,EAAEC,qBACEC,OAASX,EAAEY,MAAMC,QAAQ,SAASC,KAAK,UAC3CT,EAAEU,cAAcJ,QAAQ,OACpBK,QAAUhB,EAAEY,MAAMK,KAAK,WACvBC,YAAcC,EAAEC,KAAKC,WAAW,8BAA+B,qBAC/DC,OAAS,CACTC,OAAQvB,EAAEY,MAAMK,KAAK,WACrBO,OAAQxB,EAAEY,MAAMK,KAAK,WACrBQ,IAAKzB,EAAEY,MAAMK,KAAK,QAEtBhB,aAAayB,OAAO,CAChBC,KAAM1B,aAAa2B,MAAMC,YACzBC,MAAOX,EAAEC,KAAKC,WAAW,6BAA8B,qBACvDU,KAAMf,UACPgB,MAAK,SAASC,cACbA,MAAMC,kBAAkBhB,aACxBe,MAAME,UAAUC,GAAGlC,YAAYmC,KAAMf,OAAQjB,EAAEiC,eAC/CL,MAAMM,OAENN,MAAME,UAAUC,GAAGlC,YAAYsC,OAAQP,MAAO5B,EAAEoC,YACzCR,SACRS,OAAM,SAASC,KACdtC,EAAEuC,iBAAiBD,IAAKhC,eAIpC8B,WAAY,SAAShC,OACbwB,MAAQxB,EAAEQ,KACVN,OAASX,EAAEK,EAAEC,UAAUO,QAAQ,SAASC,KAAK,UACjDmB,MAAMY,UACNxC,EAAEU,cAAcJ,QAAQ,IAE5B2B,cAAe,SAAS7B,GACpBA,EAAEC,qBACEO,KAAOR,EAAEQ,KACT6B,aAAe9C,EAAES,EAAEE,QAAQG,KAAK,UACpCT,EAAEU,cAAc+B,cAAc,GACf3C,KAAK4C,KAAK,CAAC,CACtBC,WAAY,mCACZC,KAAM,CACF1B,OAAQN,KAAKM,OACbC,OAAQP,KAAKO,WAIZ,GAAG0B,MAAK,SAASC,SAClBC,GAAKD,IAAIC,IAAM,UACnBC,OAAOC,SAASC,KAAOlD,EAAEmD,2BAA2BvC,KAAKQ,IAAK,cAAe2B,KACtE,KACRK,MAAK,SAASd,KACbtC,EAAEuC,iBAAiBD,IAAKG,kBAGhC/B,cAAe,SAAS2C,GAAIC,QACxBD,GAAGE,KAAK,WAAYD,SAExBf,iBAAkB,SAASiB,GAAIH,IAC3BtD,aAAa0D,UAAUD,IACvBxD,EAAEU,cAAc2C,IAAI,IAExBF,2BAA4B,SAASO,IAAKC,IAAKC,WACvCC,GAAK,IAAIC,OAAO,SAAWH,IAAM,YAAa,KAC9CI,WAAkC,IAAtBL,IAAIM,QAAQ,KAAc,IAAM,WAC5CN,IAAIO,MAAMJ,IACHH,IAAIQ,QAAQL,GAAI,KAAOF,IAAM,IAAMC,MAAQ,MAE3CF,IAAMK,UAAYJ,IAAM,IAAMC,eAI1C5D"}